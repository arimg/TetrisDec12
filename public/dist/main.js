!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e){(e=t.exports={}).COLORS=["#00af9d","#ffb652","#cd66cc","#66bc29","#0096db","#3a7dda","#ffe100"],e.SIDE_WIDTH=300,e.ROW_COUNT=20,e.COLUMN_COUNT=20,e.SCENE_BG_START="#8e9ba6",e.SCENE_BG_END="#5c6975",e.PREVIEW_BG="#2f2f2f",e.PREVIEW_COUNT=6,e.GRID_LINE_COLOR="rgba(255,255,255,0.2)",e.BOX_BORDER_COLOR="rgba(255,255,255,0.5)",e.DEFAULT_INTERVAL=600,e.LEVEL_INTERVAL=12e4},function(t,e){e=t.exports={};var i=function(t){return"object"==typeof t&&!(t.constructor&&!hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))},n=function(){var t,e,r,s,h,o,a=arguments[0]||{},c=1,f=arguments.length,u=!0;for("boolean"==typeof a&&(u=a,a=arguments[c]||{},c++),"object"!=typeof a&&"function"!=typeof obj&&(a={}),c===f&&(a=this,c--);c<f;c++)if(null!=(h=arguments[c]))for(s in h)t=a[s],a!==(r=h[s])&&(u&&r&&(i(r)||(e=Array.isArray(r)))?(e?(e=!1,o=t&&Array.isArray(t)?t:[]):o=t&&i(t)?t:{},a[s]=n(u,o,r)):void 0!==r&&(a[s]=r));return a},r=function(t,e){var i=[].slice.call(arguments,2);return r=function(){return t.apply(e||this,i.concat([].slice.call(arguments)))}},s=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=s,e.$=function(t){return document.getElementById(t)},e.extend=n,e.proxy=r},function(t,e,i){i(3),t.exports=i(8)},function(t,e,i){var n=i(1),r=i(0),s=(i(4),i(5)),h=i(6),o=i(7),a=function(t,e){for(var i=t[0].length,n=e;n>=0;n--)for(var r=0;r<i;r++)t[n][r]=n>0?t[n-1][r]:0},c={maxHeight:700,maxWidth:600};function f(t,e){this.id=t,this.socket=e,this.init()}f.prototype={init:function(t){this.socket.on("backend",t=>{alert(t)});var e=this.config=n.extend(t,c);this.interval=r.DEFAULT_INTERVAL,h.init(this.id,e.maxWidth,e.maxHeight),o.init(h.scene,h.preview),this.matrix=function(t,e){for(var i=[],n=0;n<t;n++){var r=[];i.push(r);for(var s=0;s<e;s++)r.push(0)}return i}(r.ROW_COUNT,r.COLUMN_COUNT),this.reset(),this._initEvents(),this._fireShape()},reset:function(){this.running=!1,this.isGameOver=!1,this.level=1,this.score=0,this.startTime=(new Date).getTime(),this.currentTime=this.startTime,this.prevTime=this.startTime,this.levelTime=this.startTime,function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)t[e][i]=0}(this.matrix),h.setLevel(this.level),h.setScore(this.score),h.setGameOver(this.isGameOver),this._draw()},start:function(){this.running=!0,window.requestAnimationFrame(n.proxy(this._refresh,this))},pause:function(){this.running=!1,this.currentTime=(new Date).getTime(),this.prevTime=this.currentTime},gamveOver:function(){},_keydownHandler:function(t){var e=this.matrix;if(!t)t=window.event;if(!this.isGameOver&&this.shape)switch(t.keyCode){case 37:this.shape.goLeft(e),this._draw();break;case 39:this.shape.goRight(e),this._draw();break;case 38:this.shape.rotate(e),this._draw();break;case 40:this.shape.goDown(e),this._draw();break;case 32:this.shape.goBottom(e),this._update()}},_restartHandler:function(){this.reset(),this.start()},_initEvents:function(){window.addEventListener("keydown",n.proxy(this._keydownHandler,this),!1),h.btnRestart.addEventListener("click",n.proxy(this._restartHandler,this),!1)},_fireShape:function(){this.shape=this.preparedShape||s.randomShape(),this.preparedShape=s.randomShape(),this._draw(),o.drawPreviewShape(this.preparedShape)},_draw:function(){o.drawScene(),o.drawShape(this.shape),o.drawMatrix(this.matrix)},_refresh:function(){this.running&&(this.currentTime=(new Date).getTime(),this.currentTime-this.prevTime>this.interval&&(this._update(),this.prevTime=this.currentTime,this._checkLevel()),this.isGameOver||window.requestAnimationFrame(n.proxy(this._refresh,this)))},_update:function(){this.shape.canDown(this.matrix)?this.shape.goDown(this.matrix):(this.shape.copyTo(this.matrix),this._check(),this._fireShape()),this._draw(),this.isGameOver=function(t){for(var e=t[0],i=0;i<e.length;i++)if(0!==e[i])return!0;return!1}(this.matrix),h.setGameOver(this.isGameOver),this.isGameOver&&h.setFinalScore(this.score)},_check:function(){var t=function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],r=!0,s=0;s<n.length;s++)r=r&&0!==n[s];r&&e.push(i)}return e}(this.matrix);if(t.length){!function(t,e){for(var i in e)a(t,e[i])}(this.matrix,t);var e=function(t){return t&&t.length?100*t.length:0}(t),i=function(t){return t&&t.length>1?100*Math.pow(2,t.length-1):0}(t);this.score+=e+i,h.setScore(this.score),h.setReward(i)}},_checkLevel:function(){var t,e=(new Date).getTime();e-this.levelTime>r.LEVEL_INTERVAL&&(this.level+=1,this.interval=(t=this.level,r.DEFAULT_INTERVAL-60*(t-1)),h.setLevel(this.level),this.levelTime=e)}},window.Tetris=f},function(t,e){t.exports={startSocket:function(){}}},function(t,e,i){var n=i(0),r=n.COLORS,s=n.COLUMN_COUNT;function h(){this.states=[[[1,0],[1,0],[1,1]],[[0,0,1],[1,1,1]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]]],this.x=4,this.y=-3,this.flag="L"}function o(){this.states=[[[0,1],[0,1],[1,1]],[[1,1,1],[0,0,1]],[[1,1],[1,0],[1,0]],[[1,0,0],[1,1,1]]],this.x=4,this.y=-3,this.flag="LR"}function a(){this.states=[[[1,1],[1,1]]],this.x=4,this.y=-2,this.flag="O"}function c(){this.states=[[[1],[1],[1],[1]],[[1,1,1,1]]],this.x=5,this.y=-4,this.flag="I"}function f(){this.states=[[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[0,1,0],[1,1,1]],[[0,1],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="T"}function u(){this.states=[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]],this.x=4,this.y=-2,this.flag="Z"}function l(){this.states=[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="ZR"}var d=function(t,e,i){var n,r,s,h=e.length,o=e[0].length,a="rotate"===i?t.getBoxes(t.nextState()):t.getBoxes(t.state);for(var c in a)if(n=a[c],r=void 0,s=void 0,r=t.x+n.x,!((s=t.y+n.y)<0||("left"===i?(r-=1)>=0&&r<o&&0==e[s][r]:"right"===i?(r+=1)>=0&&r<o&&0==e[s][r]:"down"===i?(s+=1)<h&&0==e[s][r]:"rotate"===i?s<h&&!e[s][r]:void 0)))return!1;return!0};h.prototype=o.prototype=a.prototype=c.prototype=f.prototype=u.prototype=l.prototype={init:function(){this.color=r[Math.floor(7*Math.random())],this.state=0,this.allBoxes={},this.y=0},getBoxes:function(t){var e=this.allBoxes[t]||[];if(e.length)return e;for(var i=this.matrix(t),n=0;n<i.length;n++)for(var r=i[n],s=0;s<r.length;s++)1===r[s]&&e.push({x:s,y:n});return this.allBoxes[t]=e,e},matrix:function(t){var e=void 0!==t?t:this.state;return this.states[e]},rotate:function(t){if(d(this,t,"rotate")){this.state=this.nextState();var e=this.getRight();e>=s&&(this.x-=e-s+1)}},getColumnCount:function(){for(var t=this.matrix(),e=0,i=0;i<t.length;i++)e=Math.max(e,t[i].length);return e},getRowCount:function(){return this.matrix().length},getRight:function(){var t=this.getBoxes(this.state),e=0;for(var i in t)e=Math.max(t[i].x,e);return this.x+e},nextState:function(){return(this.state+1)%this.states.length},canDown:function(t){return d(this,t,"down")},goDown:function(t){d(this,t,"down")&&(this.y+=1)},goBottom:function(t){for(;d(this,t,"down");)this.y+=1},goLeft:function(t){d(this,t,"left")&&(this.x-=1)},goRight:function(t){d(this,t,"right")&&(this.x+=1)},copyTo:function(t){for(var e=this.matrix(),i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(1===n[r]){var s=this.x+r,h=this.y+i;s>=0&&s<t[0].length&&h>=0&&h<t.length&&(t[h][s]=this.color)}}},t.exports.randomShape=function(){var t;switch(Math.floor(7*Math.random())){case 0:t=new h;break;case 1:t=new a;break;case 2:t=new u;break;case 3:t=new f;break;case 4:t=new o;break;case 5:t=new l;break;case 6:t=new c}return t.init(),t}},function(t,e,i){var n=i(1),r=i(0),s=n.$,h=s("scene"),o=s("side"),a=s("info"),c=s("preview"),f=s("level"),u=s("score"),l=s("rewardInfo"),d=s("reward"),v=s("gameOver"),p=s("restart"),w=s("finalScore"),g=r.SIDE_WIDTH,m=function(t,e,i){var n=function(t,e){var i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,r={};return i>n?(r.height=Math.min(e,n),r.width=Math.min(r.height/2+g,t)):(r.width=Math.min(t,i),r.height=Math.min(e,n)),r}(e,i),r=t.style;r.height=n.height+"px",r.width=n.width+"px",r.marginTop=-n.height/2+"px",r.marginLeft=-n.width/2+"px",h.height=n.height,h.width=h.height/2;var s=n.width-h.width;o.style.width=s+"px",s<g&&(a.style.width=o.style.width),c.width=80,c.height=80,v.style.width=h.width+"px"},x={init:function(t,e,i){this.container=s(t),this.scene=h,this.preview=c,this.btnRestart=p,m(this.container,e,i),this.scene.focus(),l.addEventListener("animationEnd",function(t){l.className="invisible"})},setScore:function(t){u.innerHTML=t},setFinalScore:function(t){w.innerHTML=t},setLevel:function(t){f.innerHTML=t},setReward:function(t){t>0?(d.innerHTML=t,l.className="fadeOutUp animated"):l.className="invisible"},setGameOver:function(t){v.style.display=t?"block":"none"}};t.exports=x},function(t,e,i){i(1);var n=i(0),r=n.GRID_LINE_COLOR,s=n.BOX_BORDER_COLOR,h=function(t,e,i,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineWidth=1,t.strokeStyle=n,t.stroke(),t.closePath()},o=function(t,e,i,n,s,o){var a=t.getContext("2d"),c=t.width,f=t.height;a.rect(0,0,c,f);var u=a.createLinearGradient(0,0,0,f);u.addColorStop(0,s),u.addColorStop(1,o),a.fillStyle=u,a.fill();for(var l=1;l<i;l++){var d=e*l+.5;h(a,{x:d,y:0},{x:d,y:f},r)}for(l=1;l<n;l++){var v=e*l+.5;h(a,{x:0,y:v},{x:c,y:v},r)}},a=function(t,e,i,n,r){n<0||(t.beginPath(),t.rect(i,n,r,r),t.fillStyle=e,t.fill(),t.strokeStyle=s,t.lineWidth=1,t.stroke(),t.closePath())},c={init:function(t,e){this.scene=t,this.preview=e,this.sceneContext=t.getContext("2d"),this.previewContext=e.getContext("2d"),this.gridSize=t.width/n.COLUMN_COUNT,this.previewGridSize=e.width/n.PREVIEW_COUNT,this.drawScene()},clearScene:function(){this.sceneContext.clearRect(0,0,this.scene.width,this.scene.height)},clearPreview:function(){this.previewContext.clearRect(0,0,this.preview.width,this.preview.height)},drawScene:function(){this.clearScene(),o(this.scene,this.gridSize,n.COLUMN_COUNT,n.ROW_COUNT,n.SCENE_BG_START,n.SCENE_BG_END)},drawMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++)0!==i[n]&&a(this.sceneContext,i[n],n*this.gridSize,e*this.gridSize,this.gridSize)},drawPreview:function(){o(this.preview,this.previewGridSize,n.PREVIEW_COUNT,n.PREVIEW_COUNT,n.PREVIEW_BG,n.PREVIEW_BG)},drawShape:function(t){if(t)for(var e=t.matrix(),i=this.gridSize,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++){if(1===e[n][r]){var s=i*(t.x+r),h=i*(t.y+n);a(this.sceneContext,t.color,s,h,i)}}},drawPreviewShape:function(t){if(t){this.clearPreview();for(var e=t.matrix(),i=this.previewGridSize,n=(this.preview.width-i*t.getColumnCount())/2,r=(this.preview.height-i*t.getRowCount())/2,s=0;s<e.length;s++)for(var h=0;h<e[s].length;h++){if(1===e[s][h]){var o=n+i*h,c=r+i*s;a(this.previewContext,t.color,o,c,i)}}}}};t.exports=c},function(t,e,i){var n,r=!1;!function t(e,i,r){function s(o,a){if(!i[o]){if(!e[o]){if(!a&&("function"==typeof n&&n))return n(o,!0);if(h)return h(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=i[o]={exports:{}};e[o][0].call(f.exports,function(t){var i=e[o][1][t];return s(i||t)},f,f.exports,t,e,i,r)}return i[o].exports}for(var h="function"==typeof n&&n,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,e,i){t("./utils.js");var n=t("./consts.js"),r=n.GRID_LINE_COLOR,s=n.BOX_BORDER_COLOR,h=function(t,e,i,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineWidth=1,t.strokeStyle=n,t.stroke(),t.closePath()},o=function(t,e,i,n,s,o){var a=t.getContext("2d"),c=t.width,f=t.height;a.rect(0,0,c,f);var u=a.createLinearGradient(0,0,0,f);u.addColorStop(0,s),u.addColorStop(1,o),a.fillStyle=u,a.fill();for(var l=1;l<i;l++){var d=e*l+.5;h(a,{x:d,y:0},{x:d,y:f},r)}for(l=1;l<n;l++){var v=e*l+.5;h(a,{x:0,y:v},{x:c,y:v},r)}},a=function(t,e,i,n,r){n<0||(t.beginPath(),t.rect(i,n,r,r),t.fillStyle=e,t.fill(),t.strokeStyle=s,t.lineWidth=1,t.stroke(),t.closePath())},c={init:function(t,e){this.scene=t,this.preview=e,this.sceneContext=t.getContext("2d"),this.previewContext=e.getContext("2d"),this.gridSize=t.width/n.COLUMN_COUNT,this.previewGridSize=e.width/n.PREVIEW_COUNT,this.drawScene()},clearScene:function(){this.sceneContext.clearRect(0,0,this.scene.width,this.scene.height)},clearPreview:function(){this.previewContext.clearRect(0,0,this.preview.width,this.preview.height)},drawScene:function(){this.clearScene(),o(this.scene,this.gridSize,n.COLUMN_COUNT,n.ROW_COUNT,n.SCENE_BG_START,n.SCENE_BG_END)},drawMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++)0!==i[n]&&a(this.sceneContext,i[n],n*this.gridSize,e*this.gridSize,this.gridSize)},drawPreview:function(){o(this.preview,this.previewGridSize,n.PREVIEW_COUNT,n.PREVIEW_COUNT,n.PREVIEW_BG,n.PREVIEW_BG)},drawShape:function(t){if(t)for(var e=t.matrix(),i=this.gridSize,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++){if(1===e[n][r]){var s=i*(t.x+r),h=i*(t.y+n);a(this.sceneContext,t.color,s,h,i)}}},drawPreviewShape:function(t){if(t){this.clearPreview();for(var e=t.matrix(),i=this.previewGridSize,n=(this.preview.width-i*t.getColumnCount())/2,r=(this.preview.height-i*t.getRowCount())/2,s=0;s<e.length;s++)for(var h=0;h<e[s].length;h++){if(1===e[s][h]){var o=n+i*h,c=r+i*s;a(this.previewContext,t.color,o,c,i)}}}}};e.exports=c},{"./consts.js":2,"./utils.js":5}],2:[function(t,e,i){(i=e.exports={}).COLORS=["#00af9d","#ffb652","#cd66cc","#66bc29","#0096db","#3a7dda","#ffe100"],i.SIDE_WIDTH=120,i.ROW_COUNT=20,i.COLUMN_COUNT=10,i.SCENE_BG_START="#8e9ba6",i.SCENE_BG_END="#5c6975",i.PREVIEW_BG="#2f2f2f",i.PREVIEW_COUNT=6,i.GRID_LINE_COLOR="rgba(255,255,255,0.2)",i.BOX_BORDER_COLOR="rgba(255,255,255,0.5)",i.DEFAULT_INTERVAL=600,i.LEVEL_INTERVAL=12e4},{}],3:[function(t,e,i){var n=t("./utils.js"),s=t("./consts.js"),h=t("./shapes.js"),o=t("./views.js"),a=t("./canvas.js"),c=function(t,e){for(var i=t[0].length,n=e;n>=0;n--)for(var r=0;r<i;r++)t[n][r]=n>0?t[n-1][r]:0},f={maxHeight:700,maxWidth:600};function u(t){this.id=t,this.init()}u.prototype={init:function(t){var e=this.config=n.extend(t,f);this.interval=s.DEFAULT_INTERVAL,o.init(this.id,e.maxWidth,e.maxHeight),a.init(o.scene,o.preview),this.matrix=function(t,e){for(var i=[],n=0;n<t;n++){var r=[];i.push(r);for(var s=0;s<e;s++)r.push(0)}return i}(s.ROW_COUNT,s.COLUMN_COUNT),this.reset(),this._initEvents(),this._fireShape()},reset:function(){this.running=!1,this.isGameOver=!1,this.level=1,this.score=0,this.startTime=(new Date).getTime(),this.currentTime=this.startTime,this.prevTime=this.startTime,this.levelTime=this.startTime,function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)t[e][i]=0}(this.matrix),o.setLevel(this.level),o.setScore(this.score),o.setGameOver(this.isGameOver),this._draw()},start:function(){this.running=!0,window.requestAnimationFrame(n.proxy(this._refresh,this))},pause:function(){this.running=!1,this.currentTime=(new Date).getTime(),this.prevTime=this.currentTime},gamveOver:function(){},_keydownHandler:function(t){var e=this.matrix;if(!t)t=window.event;if(!this.isGameOver&&this.shape)if(r)switch(t.keyCode){case 65:this.shape.goLeft(e),this._draw();break;case 68:this.shape.goRight(e),this._draw();break;case 87:this.shape.rotate(e),this._draw();break;case 83:this.shape.goDown(e),this._draw();break;case 32:this.shape.goBottom(e),this._update()}else switch(t.keyCode){case 37:this.shape.goLeft(e),this._draw();break;case 39:this.shape.goRight(e),this._draw();break;case 38:this.shape.rotate(e),this._draw();break;case 40:this.shape.goDown(e),this._draw();break;case 32:this.shape.goBottom(e),this._update()}},_restartHandler:function(){this.reset(),this.start()},_initEvents:function(){window.addEventListener("keydown",n.proxy(this._keydownHandler,this),!1),o.btnRestart.addEventListener("click",n.proxy(this._restartHandler,this),!1)},_fireShape:function(){this.shape=this.preparedShape||h.randomShape(),this.preparedShape=h.randomShape(),this._draw(),a.drawPreviewShape(this.preparedShape)},_draw:function(){a.drawScene(),a.drawShape(this.shape),a.drawMatrix(this.matrix)},_refresh:function(){this.running&&(this.currentTime=(new Date).getTime(),this.currentTime-this.prevTime>this.interval&&(this._update(),this.prevTime=this.currentTime,this._checkLevel()),this.isGameOver||window.requestAnimationFrame(n.proxy(this._refresh,this)))},_update:function(){this.shape.canDown(this.matrix)?this.shape.goDown(this.matrix):(this.shape.copyTo(this.matrix),this._check(),this._fireShape()),this._draw(),this.isGameOver=function(t){for(var e=t[0],i=0;i<e.length;i++)if(0!==e[i])return!0;return!1}(this.matrix),o.setGameOver(this.isGameOver),this.isGameOver&&o.setFinalScore(this.score)},_check:function(){var t=function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],r=!0,s=0;s<n.length;s++)r=r&&0!==n[s];r&&e.push(i)}return e}(this.matrix);if(t.length){!function(t,e){for(var i in e)c(t,e[i])}(this.matrix,t);var e=function(t){return t&&t.length?100*t.length:0}(t),i=function(t){return t&&t.length>1?100*Math.pow(2,t.length-1):0}(t);this.score+=e+i,o.setScore(this.score),o.setReward(i)}document.getElementById("player").innerHTML=r?"Player1":"Player2",r=!r,console.log("next block "+r)},_checkLevel:function(){var t,e=(new Date).getTime();e-this.levelTime>s.LEVEL_INTERVAL&&(this.level+=1,this.interval=(t=this.level,s.DEFAULT_INTERVAL-60*(t-1)),o.setLevel(this.level),this.levelTime=e)}},window.Tetris=u},{"./canvas.js":1,"./consts.js":2,"./shapes.js":4,"./utils.js":5,"./views.js":6}],4:[function(t,e,i){var n=t("./consts.js"),r=n.COLORS,s=n.COLUMN_COUNT;function h(){this.states=[[[1,0],[1,0],[1,1]],[[0,0,1],[1,1,1]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]]],this.x=4,this.y=-3,this.flag="L"}function o(){this.states=[[[0,1],[0,1],[1,1]],[[1,1,1],[0,0,1]],[[1,1],[1,0],[1,0]],[[1,0,0],[1,1,1]]],this.x=4,this.y=-3,this.flag="LR"}function a(){this.states=[[[1,1],[1,1]]],this.x=4,this.y=-2,this.flag="O"}function c(){this.states=[[[1],[1],[1],[1]],[[1,1,1,1]]],this.x=5,this.y=-4,this.flag="I"}function f(){this.states=[[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[0,1,0],[1,1,1]],[[0,1],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="T"}function u(){this.states=[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]],this.x=4,this.y=-2,this.flag="Z"}function l(){this.states=[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="ZR"}var d=function(t,e,i){var n,r,s,h=e.length,o=e[0].length,a="rotate"===i?t.getBoxes(t.nextState()):t.getBoxes(t.state);for(var c in a)if(n=a[c],r=void 0,s=void 0,r=t.x+n.x,!((s=t.y+n.y)<0||("left"===i?(r-=1)>=0&&r<o&&0==e[s][r]:"right"===i?(r+=1)>=0&&r<o&&0==e[s][r]:"down"===i?(s+=1)<h&&0==e[s][r]:"rotate"===i?s<h&&!e[s][r]:void 0)))return!1;return!0};h.prototype=o.prototype=a.prototype=c.prototype=f.prototype=u.prototype=l.prototype={init:function(){this.color=r[Math.floor(7*Math.random())],this.state=0,this.allBoxes={},this.y=0},getBoxes:function(t){var e=this.allBoxes[t]||[];if(e.length)return e;for(var i=this.matrix(t),n=0;n<i.length;n++)for(var r=i[n],s=0;s<r.length;s++)1===r[s]&&e.push({x:s,y:n});return this.allBoxes[t]=e,e},matrix:function(t){var e=void 0!==t?t:this.state;return this.states[e]},rotate:function(t){if(d(this,t,"rotate")){this.state=this.nextState();var e=this.getRight();e>=s&&(this.x-=e-s+1)}},getColumnCount:function(){for(var t=this.matrix(),e=0,i=0;i<t.length;i++)e=Math.max(e,t[i].length);return e},getRowCount:function(){return this.matrix().length},getRight:function(){var t=this.getBoxes(this.state),e=0;for(var i in t)e=Math.max(t[i].x,e);return this.x+e},nextState:function(){return(this.state+1)%this.states.length},canDown:function(t){return d(this,t,"down")},goDown:function(t){d(this,t,"down")&&(this.y+=1)},goBottom:function(t){for(;d(this,t,"down");)this.y+=1},goLeft:function(t){d(this,t,"left")&&(this.x-=1)},goRight:function(t){d(this,t,"right")&&(this.x+=1)},copyTo:function(t){for(var e=this.matrix(),i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(1===n[r]){var s=this.x+r,h=this.y+i;s>=0&&s<t[0].length&&h>=0&&h<t.length&&(t[h][s]=this.color)}}},e.exports.randomShape=function(){var t;switch(Math.floor(7*Math.random())){case 0:t=new h;break;case 1:t=new a;break;case 2:t=new u;break;case 3:t=new f;break;case 4:t=new o;break;case 5:t=new l;break;case 6:t=new c}return t.init(),t}},{"./consts.js":2}],5:[function(t,e,i){i=e.exports={};var n=function(t){return"object"==typeof t&&!(t.constructor&&!hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))},r=function(){var t,e,i,s,h,o,a=arguments[0]||{},c=1,f=arguments.length,u=!0;for("boolean"==typeof a&&(u=a,a=arguments[c]||{},c++),"object"!=typeof a&&"function"!=typeof obj&&(a={}),c===f&&(a=this,c--);c<f;c++)if(null!=(h=arguments[c]))for(s in h)t=a[s],a!==(i=h[s])&&(u&&i&&(n(i)||(e=Array.isArray(i)))?(e?(e=!1,o=t&&Array.isArray(t)?t:[]):o=t&&n(t)?t:{},a[s]=r(u,o,i)):void 0!==i&&(a[s]=i));return a},s=function(t,e){var i=[].slice.call(arguments,2);return s=function(){return t.apply(e||this,i.concat([].slice.call(arguments)))}},h=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=h,i.$=function(t){return document.getElementById(t)},i.extend=r,i.proxy=s},{}],6:[function(t,e,i){var n=t("./utils.js"),r=t("./consts.js"),s=n.$,h=s("scene"),o=s("side"),a=s("info"),c=s("preview"),f=s("level"),u=s("score"),l=s("rewardInfo"),d=s("reward"),v=s("gameOver"),p=s("restart"),w=s("finalScore"),g=(s("player"),r.SIDE_WIDTH),m=function(t,e,i){var n=function(t,e){var i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,r={};return i>n?(r.height=Math.min(e,n),r.width=Math.min(r.height/2+g,t)):(r.width=Math.min(t,i),r.height=Math.min(e,n)),r}(e,i),r=t.style;r.height=n.height+"px",r.width=n.width+"px",r.marginTop=-n.height/2+"px",r.marginLeft=-n.width/2+"px",h.height=n.height,h.width=h.height/2;var s=n.width-h.width;o.style.width=s+"px",s<g&&(a.style.width=o.style.width),c.width=80,c.height=80,v.style.width=h.width+"px"},x={init:function(t,e,i){this.container=s(t),this.scene=h,this.preview=c,this.btnRestart=p,m(this.container,e,i),this.scene.focus(),l.addEventListener("animationEnd",function(t){l.className="invisible"})},setScore:function(t){u.innerHTML=t},setFinalScore:function(t){w.innerHTML=t},setLevel:function(t){f.innerHTML=t},setReward:function(t){t>0?(d.innerHTML=t,l.className="fadeOutUp animated"):l.className="invisible"},setGameOver:function(t){v.style.display=t?"block":"none"}};e.exports=x},{"./consts.js":2,"./utils.js":5}]},{},[3])}]);